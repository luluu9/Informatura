TAGI:
SQL,grupowanie danych,prawda/faÅ‚sz,funkcje agregujÄ…ce,podzapytania
PUNKTY:
1
TRESC:
RozwaÅ¼ nastÄ™pujÄ…ce zapytanie SQL do pewnej bazy danych:
SELECT pesel, COUNT(*)
FROM samochody
WHERE pesel NOT IN (SELECT pesel FROM dokumenty_zastrzezone)
GROUP BY pesel HAVING COUNT(*) > 1 

ROZWIAZANIE:
Dobra, popatrzmy co tu mamy:
- SELECT pesel, COUNT(*): wybieramy dwie wartoÅ›ci: pesel i COUNT(*); druga brzmi bardziej tajemniczo ğŸ¤” Jednak Å¼adnej magii tu nie ma - wspominaliÅ›my o tym w poprzednim zdaniu, jest to funkcja agregujÄ…ca, czyli taka, ktÃ³ra zbiera wszystkie wartoÅ›ci wedÅ‚ug kolumny (atrybutu) podanej po pÃ³Åºniejszej instrukcji GROUP BY (w tym wypadku kolumna pesel) i potem na jej podstawie wykonuje jakieÅ› obliczenia, np. COUNT - zliczanie, AVG - Å›rednia czy SUM - suma. W kaÅ¼dym z tych przypadkÃ³w nazwy te pochodzÄ… z jÄ™zyka angielskiego, wiÄ™c czÄ™sto wystarczy je po prostu przetÅ‚umaczyÄ‡, Å¼eby zrozumieÄ‡ ich sens. Tu wystÄ™puje COUNT(*) - gwiazda oznacza, Å¼e zliczamy kaÅ¼dy wiersz, ktÃ³ry pojawiÅ‚ siÄ™ wraz z danÄ… wartoÅ›ciÄ… kolumny pesel. PrzykÅ‚adowo (z uproszczeniem): jeÅ›li bÄ™dziemy mieli 5 wierszy z wartoÅ›ciÄ… w atrybucie pesel 123 i 2 z wartoÅ›ciÄ… 221, to funkcja COUNT zwrÃ³ci odpowiednio wartoÅ›ci 5 i 2. ZrozumiaÅ‚e, prawda? ğŸ˜‰ Trzeba jednak pamiÄ™taÄ‡, Å¼e do takich funkcji agregujÄ…cych musi â€¼ wystÄ…piÄ‡ grupowanie poprzez klauzule GROUP BY. ğŸ˜¤

- FROM samochody: z tabeli samochody ğŸš—

- WHERE pesel NOT IN (SELECT pesel FROM dokumenty_zastrzezone): tu siÄ™ porobiÅ‚o ğŸ™†â€â™€ï¸ Ale jakoÅ› damy radÄ™. ğŸ’ª 
WHERE oznacza warunek -> pesel NIE MOÅ»E wystÄ…piÄ‡ w podzapytaniu (SELECT ...). JeÅ›li pesel siÄ™ tam znajdzie,  to nie pojawi siÄ™ w ostatecznym wyniku. Trzeba jednak przeanalizowaÄ‡ to, co znajduje siÄ™ wewnÄ…trz tych nawiasÃ³w. 
Zbyt skomplikowany proces tu nie zachodzi: wybieramy pesel z tabeli dokumenty_zastrzezone. Tak w razie czego, gdyby ktoÅ› chciaÅ‚ wziÄ…Ä‡ chwilÃ³wkÄ™ na nasz zgubiony dowÃ³d. ğŸ¤ ğŸ‘®â€â™‚ï¸

- GROUP BY pesel HAVING COUNT(*) > 1: okej, mamy nasze grupowanie, o ktÃ³rym mÃ³wiliÅ›my na poczÄ…tku. Jednak pojawia siÄ™ jakaÅ› klauzula HAVING. ğŸ˜’ Okej, wpiszmy to w googla: co wychodzi? tÅ‚umaczeniem having jest "majÄ…cy", czy "posiadajÄ…cy". MoÅ¼e coÅ› nasuwa wam siÄ™ na myÅ›l? ğŸ’­ 
Chodzi o to, Å¼e wybrane zostanÄ… jedynie te grupy, ktÃ³re speÅ‚niajÄ… ten warunek -> posiadajÄ… wartoÅ›Ä‡ COUNT(*) wiÄ™kszÄ… od 1. Czyli jeÅ›li jakiÅ› pesel pojawi siÄ™ tylko raz, zostanie on wykluczony z wynikÃ³w. ğŸ¤·â€â™€ï¸

Okej, wiemy juÅ¼ co dokÅ‚adnie znaczy kaÅ¼dy fragment w tym zapytaniu. Teraz zabierzmy siÄ™ za nasz Å¼yciowy cel - odpowiedzi na pytania! ğŸ¥³ 

1) ten sam numer PESEL moÅ¼e pojawiÄ‡ wiÄ™cej niÅ¼ jeden raz. [P/F]: jak wspomnieliÅ›my - GROUP BY grupuje wiersze w tym wypadku na podstawie peselu, wiÄ™c kaÅ¼dy pesel moÅ¼e pojawiÄ‡ siÄ™ jedynie raz. A wiÄ™c jest to FAÅSZ. â˜º

2) nie pojawi siÄ™ Å¼aden numer PESEL, ktÃ³ry jest zapisany w tabeli dokumenty_zastrzezone. [P/F]: patrzÄ…c na warunek znajdujÄ…cy siÄ™ po WHERE, musimy przyznaÄ‡ racjÄ™ temu zapisowi. PRAWDA.

3) otrzymasz tabelÄ™ o 2 kolumnach. [P/F]: po czym stwierdziÄ‡ ile kolumn bÄ™dzie miaÅ‚ wynik zapytania? ano, po liczbie nazw/instrukcji, ktÃ³re pojawiajÄ… siÄ™ po klauzuli SELECT. Tutaj mamy dwa: pesel i COUNT(*). A wiÄ™c moÅ¼emy z pewnoÅ›ciÄ… stwierdziÄ‡, Å¼e jest to PRAWDA. ğŸ˜‡

4) przy odpowiednich danych moÅ¼e pojawiÄ‡ siÄ™ wiersz â€82122302134, 1â€. [P/F]: okej, mamy podany tu wynik zapytania. ğŸ¤¨ â€82122302134" bÄ™dzie peselem, a 1 iloÅ›ciÄ… wystÄ…pieÅ„ tego peselu w tabeli samochody. Jednak przypomnijmy sobie, co jest zapisane w ostatniej linijce. HAVING COUNT(*) > 1. WiÄ™ksze niÅ¼ 1, nie rÃ³wne bÄ…dÅº wiÄ™ksze. Czyli minimalna iloÅ›Ä‡, jaka moÅ¼e siÄ™ pojawiÄ‡, to 2. A tu mamy... 1! A wiÄ™c zaznaczamy FAÅSZ. ğŸ˜